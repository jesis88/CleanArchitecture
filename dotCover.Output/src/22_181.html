<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>E:\CleanArchitecture\Infrastructure\Wrappers\UserManagerWrapper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Application.EntityUser.Query;
using Application.Interfaces;
using AutoMapper;
using Domain.Entity;
using Infrastructure.Persistence.Repositories;
using Microsoft.AspNetCore.Identity;
using Microsoft.EntityFrameworkCore;

namespace Infrastructure.Wrappers
{
    public class UserManagerWrapper(UserManager&lt;ApplicationUser&gt; userManager, IMapper mapper) : IUserManagerWrapper
    {
        private readonly UserManager&lt;ApplicationUser&gt; _userManager = userManager;
        private readonly IMapper _mapper = mapper;

        public async Task&lt;IdentityResult&gt; AddToRolesAsync(User user, IEnumerable&lt;string&gt;role)
        {
            ThrowIfNull(user.UserName,&quot;Username is null&quot;);
            var applicationUser = await _userManager.FindByNameAsync(user.UserName!);
            ThrowIfNull(applicationUser, &quot;ApplicationUser is null&quot;);

            return await _userManager.AddToRolesAsync(applicationUser!, role);
        }

        public async Task&lt;IList&lt;string&gt;&gt; GetRolesAsync(User user)
        {
            var applicationUser = await _userManager.FindByNameAsync(user.UserName!);
            return await _userManager.GetRolesAsync(applicationUser!);
        }

        public Task&lt;IdentityResult&gt; CreateAsync(User user, string password)
        {
            var applicationUser = _mapper.Map&lt;ApplicationUser&gt;(user);
            return _userManager.CreateAsync(applicationUser, password);
        }

        public async Task&lt;User?&gt; FindByNameAsync(string userName)
        {
            var applicationUser = await _userManager.FindByNameAsync(userName);
            ThrowIfNull(applicationUser, &quot;ApplicationUser is null&quot;);
            var user = _mapper.Map&lt;User&gt;(applicationUser);
            return user;
        }

        public async Task&lt;User?&gt; FindByEmailAsync(string email)
        {
            var applicationUser = await _userManager.FindByEmailAsync(email);
            ThrowIfNull(applicationUser,&quot;ApplicationUser is null&quot;);
            var user = _mapper.Map&lt;User&gt;(applicationUser);
            return user;
        }

        public async Task&lt;bool&gt; CheckPasswordAsync(User user, string password)
        {
            var applicationUser = await _userManager.FindByNameAsync(user.UserName!);
            return await _userManager.CheckPasswordAsync(applicationUser!, password);
        }

        public async Task&lt;IdentityResult&gt; UpdateAsync(User user)
        {
            var applicationUser = await _userManager.FindByNameAsync(user.UserName!);
            applicationUser!.RecentLogin = user.RecentLogin;
            return await _userManager.UpdateAsync(applicationUser);
        }

        public async Task&lt;List&lt;User&gt;&gt; ToListAsync(GetUserListQuery query, CancellationToken cancellationToken)
        {
            var applicationUser = await _userManager.Users.Skip((query.PageNumber - 1) * query.PageSize).Take(query.PageSize).ToListAsync(cancellationToken);
            return _mapper.Map&lt;List&lt;User&gt;&gt;(applicationUser);
        }

        private static void ThrowIfNull(object? value, string errorMessage)
        {
            if(value == null)
            {
                throw new InvalidOperationException(errorMessage);
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[11,18,11,94,1],[13,9,13,82,1],[14,9,14,51,1],[17,9,17,10,1],[18,13,18,59,1],[19,13,19,86,1],[20,13,20,69,1],[22,13,22,79,1],[23,9,23,10,1],[26,9,26,10,1],[27,13,27,86,1],[28,13,28,71,1],[29,9,29,10,1],[32,9,32,10,1],[33,13,33,70,1],[34,13,34,72,1],[35,9,35,10,1],[38,9,38,10,1],[39,13,39,80,1],[40,13,40,69,1],[41,13,41,59,1],[42,13,42,25,1],[43,9,43,10,1],[46,9,46,10,1],[47,13,47,78,1],[48,13,48,68,1],[49,13,49,59,1],[50,13,50,25,1],[51,9,51,10,1],[54,9,54,10,1],[55,13,55,86,1],[56,13,56,86,1],[57,9,57,10,1],[60,9,60,10,1],[61,13,61,86,1],[62,13,62,61,1],[63,13,63,68,1],[64,9,64,10,1],[67,9,67,10,1],[68,13,68,158,1],[69,13,69,61,1],[70,9,70,10,1],[73,9,73,10,1],[74,13,74,30,1],[75,13,75,14,1],[76,17,76,67,1],[78,9,78,10,1]]);
    </script>
  </body>
</html>