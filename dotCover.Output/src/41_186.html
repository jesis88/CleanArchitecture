<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>E:\CleanArchitecture\Application\EntityUser\Commands\CommandHandlers\CreateUserHandler.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Application.EntityUser.Commands;
using Application.Interfaces;
using AutoMapper;
using Domain.Entity;
using MediatR;
using Microsoft.AspNetCore.Identity;
using System.Globalization;

namespace Application.EntityUser.Commands.CommandHandlers
{
    public class CreateUserHandler(IUserManagerWrapper userManager, IRoleManagerWrapper roleManager) : IRequestHandler&lt;CreateUserCommand, string&gt;
    {
        private readonly IUserManagerWrapper _userManager = userManager;
        private readonly IRoleManagerWrapper _roleManager = roleManager;

        public async Task&lt;string&gt; Handle(CreateUserCommand command, CancellationToken cancellationToken)
        {
            var user = new User()
            {
                Id = Guid.NewGuid().ToString(),
                UserName = command.UserName,
                Email = command.Email
            };

            var result = await _userManager.CreateAsync(user, command.Password!);
            if (result.Succeeded)
            {
                var textInfo = new CultureInfo(&quot;en-US&quot;, false).TextInfo;
                var role = textInfo.ToTitleCase(command.Role.ToString()!.ToLower());
                if (Enum.TryParse&lt;Role&gt;(role, out var roleEnum) &amp;&amp; await _roleManager.RoleExistsAsync(roleEnum.ToString()))
                {
                    var roles = new List&lt;string&gt; { roleEnum.ToString() };
                    await _userManager.AddToRolesAsync(user, roles);
                }
                else
                {
                    return $&quot;User with role {roleEnum} does not exist. Please enter any of these roles {string.Join(&quot;,&quot;, Enum.GetNames&lt;Role&gt;())}&quot;;
                }
            }
            return &quot;User created successfully&quot;;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[11,18,11,101,1],[13,9,13,73,1],[14,9,14,73,1],[17,9,17,10,1],[18,13,23,15,1],[25,13,25,82,1],[26,13,26,34,1],[27,13,27,14,1],[28,17,28,73,1],[29,17,29,85,1],[30,17,30,124,1],[31,17,31,18,1],[32,21,32,74,1],[33,21,33,69,1],[34,17,34,18,1],[36,17,36,18,0],[37,21,37,147,0],[39,13,39,14,1],[40,13,40,48,1],[41,9,41,10,1]]);
    </script>
  </body>
</html>