<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>E:\CleanArchitecture\Application\EntityUser\Commands\CommandHandlers\CreateUserHandler.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Application.EntityUser.Commands;
using Application.Interfaces;
using AutoMapper;
using Domain.Entity;
using MediatR;
using Microsoft.AspNetCore.Identity;
using System.Globalization;

namespace Application.EntityUser.Commands.CommandHandlers
{
    public class CreateUserHandler : IRequestHandler&lt;CreateUserCommand, string&gt;
    {
        private readonly IUserManagerWrapper _userManager;
        private readonly IRoleManagerWrapper _roleManager;

        public CreateUserHandler(IUserManagerWrapper userManager, IRoleManagerWrapper roleManager)
        {
            _userManager = userManager;
            _roleManager = roleManager;
        }

        public async Task&lt;string&gt; Handle(CreateUserCommand command, CancellationToken cancellationToken)
        {
            var user = new User()
            {
                Id = Guid.NewGuid().ToString(),
                UserName = command.UserName,
                Email = command.Email
            };

            var result = await _userManager.CreateAsync(user, command.Password);
            if (result.Succeeded)
            {
                var textInfo = new CultureInfo(&quot;en-US&quot;, false).TextInfo;
                var role = textInfo.ToTitleCase(command.Role.ToString().ToLower());
                if (Enum.TryParse&lt;Role&gt;(role, out var roleEnum) &amp;&amp; await _roleManager.RoleExistsAsync(roleEnum.ToString()))
                {
                    var roles = new List&lt;string&gt; { roleEnum.ToString() };
                    await _userManager.AddToRolesAsync(user, roles);
                }
                else
                {
                    return $&quot;User with role {roleEnum} does not exist. Please enter any of these roles {string.Join(&quot;,&quot;, Enum.GetNames&lt;Role&gt;())}&quot;;
                }
            }
            return &quot;User created successfully&quot;;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,99,1],[17,9,17,10,1],[18,13,18,40,1],[19,13,19,40,1],[20,9,20,10,1],[23,9,23,10,1],[24,13,29,15,1],[31,13,31,81,1],[32,13,32,34,1],[33,13,33,14,1],[34,17,34,73,1],[35,17,35,84,1],[36,17,36,124,1],[37,17,37,18,1],[38,21,38,74,1],[39,21,39,69,1],[40,17,40,18,1],[42,17,42,18,0],[43,21,43,147,0],[45,13,45,14,1],[46,13,46,48,1],[47,9,47,10,1]]);
    </script>
  </body>
</html>