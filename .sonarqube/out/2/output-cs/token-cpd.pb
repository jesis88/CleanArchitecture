ìC
BE:\CleanArchitecture\Infrastructure\Wrappers\UserManagerWrapper.cs
	namespace		 	
Infrastructure		
 
.		 
Wrappers		 !
{

 
public 

class 
UserManagerWrapper #
(# $
UserManager$ /
</ 0
ApplicationUser0 ?
>? @
userManagerA L
,L M
IMapperN U
mapperV \
)\ ]
:^ _
IUserManagerWrapper` s
{ 
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
=C D
userManagerE P
;P Q
private 
readonly 
IMapper  
_mapper! (
=) *
mapper+ 1
;1 2
public 
async 
Task 
< 
IdentityResult (
>( )
AddToRolesAsync* 9
(9 :
User: >
user? C
,C D
IEnumerableE P
<P Q
stringQ W
>W X
roleX \
)\ ]
{ 	
ThrowIfNull 
( 
user 
. 
UserName %
,% &
$str& 8
)8 9
;9 :
var 
applicationUser 
=  !
await" '
_userManager( 4
.4 5
FindByNameAsync5 D
(D E
userE I
.I J
UserNameJ R
!R S
)S T
;T U
ThrowIfNull 
( 
applicationUser '
,' (
$str) B
)B C
;C D
return 
await 
_userManager %
.% &
AddToRolesAsync& 5
(5 6
applicationUser6 E
!E F
,F G
roleH L
)L M
;M N
} 	
public 
async 
Task 
< 
IList 
<  
string  &
>& '
>' (
GetRolesAsync) 6
(6 7
User7 ;
user< @
)@ A
{ 	
var 
applicationUser 
=  !
await" '
_userManager( 4
.4 5
FindByNameAsync5 D
(D E
userE I
.I J
UserNameJ R
!R S
)S T
;T U
return 
await 
_userManager %
.% &
GetRolesAsync& 3
(3 4
applicationUser4 C
!C D
)D E
;E F
} 	
public 
Task 
< 
IdentityResult "
>" #
CreateAsync$ /
(/ 0
User0 4
user5 9
,9 :
string; A
passwordB J
)J K
{   	
var!! 
applicationUser!! 
=!!  !
_mapper!!" )
.!!) *
Map!!* -
<!!- .
ApplicationUser!!. =
>!!= >
(!!> ?
user!!? C
)!!C D
;!!D E
return"" 
_userManager"" 
.""  
CreateAsync""  +
(""+ ,
applicationUser"", ;
,""; <
password""= E
)""E F
;""F G
}## 	
public%% 
async%% 
Task%% 
<%% 
User%% 
?%% 
>%%  
FindByNameAsync%%! 0
(%%0 1
string%%1 7
userName%%8 @
)%%@ A
{&& 	
var'' 
applicationUser'' 
=''  !
await''" '
_userManager''( 4
.''4 5
FindByNameAsync''5 D
(''D E
userName''E M
)''M N
;''N O
ThrowIfNull(( 
((( 
applicationUser(( '
,((' (
$str(() B
)((B C
;((C D
var)) 
user)) 
=)) 
_mapper)) 
.)) 
Map)) "
<))" #
User))# '
>))' (
())( )
applicationUser))) 8
)))8 9
;))9 :
return** 
user** 
;** 
}++ 	
public-- 
async-- 
Task-- 
<-- 
User-- 
?-- 
>--  
FindByEmailAsync--! 1
(--1 2
string--2 8
email--9 >
)--> ?
{.. 	
var// 
applicationUser// 
=//  !
await//" '
_userManager//( 4
.//4 5
FindByEmailAsync//5 E
(//E F
email//F K
)//K L
;//L M
ThrowIfNull00 
(00 
applicationUser00 '
,00' (
$str00( A
)00A B
;00B C
var11 
user11 
=11 
_mapper11 
.11 
Map11 "
<11" #
User11# '
>11' (
(11( )
applicationUser11) 8
)118 9
;119 :
return22 
user22 
;22 
}33 	
public55 
async55 
Task55 
<55 
bool55 
>55 
CheckPasswordAsync55  2
(552 3
User553 7
user558 <
,55< =
string55> D
password55E M
)55M N
{66 	
var77 
applicationUser77 
=77  !
await77" '
_userManager77( 4
.774 5
FindByNameAsync775 D
(77D E
user77E I
.77I J
UserName77J R
!77R S
)77S T
;77T U
return88 
await88 
_userManager88 %
.88% &
CheckPasswordAsync88& 8
(888 9
applicationUser889 H
!88H I
,88I J
password88K S
)88S T
;88T U
}99 	
public;; 
async;; 
Task;; 
<;; 
IdentityResult;; (
>;;( )
UpdateAsync;;* 5
(;;5 6
User;;6 :
user;;; ?
);;? @
{<< 	
var== 
applicationUser== 
===  !
await==" '
_userManager==( 4
.==4 5
FindByNameAsync==5 D
(==D E
user==E I
.==I J
UserName==J R
!==R S
)==S T
;==T U
applicationUser>> 
!>> 
.>> 
RecentLogin>> (
=>>) *
user>>+ /
.>>/ 0
RecentLogin>>0 ;
;>>; <
return?? 
await?? 
_userManager?? %
.??% &
UpdateAsync??& 1
(??1 2
applicationUser??2 A
)??A B
;??B C
}@@ 	
publicBB 
asyncBB 
TaskBB 
<BB 
ListBB 
<BB 
UserBB #
>BB# $
>BB$ %
ToListAsyncBB& 1
(BB1 2
GetUserListQueryBB2 B
queryBBC H
,BBH I
CancellationTokenBBJ [
cancellationTokenBB\ m
)BBm n
{CC 	
varDD 
applicationUserDD 
=DD  !
awaitDD" '
_userManagerDD( 4
.DD4 5
UsersDD5 :
.DD: ;
SkipDD; ?
(DD? @
(DD@ A
queryDDA F
.DDF G

PageNumberDDG Q
-DDR S
$numDDT U
)DDU V
*DDW X
queryDDY ^
.DD^ _
PageSizeDD_ g
)DDg h
.DDh i
TakeDDi m
(DDm n
queryDDn s
.DDs t
PageSizeDDt |
)DD| }
.DD} ~
ToListAsync	DD~ â
(
DDâ ä
cancellationToken
DDä õ
)
DDõ ú
;
DDú ù
returnEE 
_mapperEE 
.EE 
MapEE 
<EE 
ListEE #
<EE# $
UserEE$ (
>EE( )
>EE) *
(EE* +
applicationUserEE+ :
)EE: ;
;EE; <
}FF 	
privateHH 
staticHH 
voidHH 
ThrowIfNullHH '
(HH' (
objectHH( .
?HH. /
valueHH0 5
,HH5 6
stringHH7 =
errorMessageHH> J
)HHJ K
{II 	
ifJJ 
(JJ 
valueJJ 
==JJ 
nullJJ 
)JJ 
throwKK 
newKK %
InvalidOperationExceptionKK 3
(KK3 4
errorMessageKK4 @
)KK@ A
;KKA B
}LL 	
}MM 
}NN Û	
BE:\CleanArchitecture\Infrastructure\Wrappers\RoleManagerWrapper.cs
	namespace 	
Infrastructure
 
. 
Wrappers !
{ 
public 

class 
RoleManagerWrapper #
:$ %
IRoleManagerWrapper& 9
{ 
private		 
readonly		 
RoleManager		 $
<		$ %
IdentityRole		% 1
<		1 2
string		2 8
>		8 9
>		9 :
_roleManager		; G
;		G H
public 
RoleManagerWrapper !
(! "
RoleManager" -
<- .
IdentityRole. :
<: ;
string; A
>A B
>B C
roleManagerD O
)O P
{ 	
_roleManager 
= 
roleManager &
;& '
} 	
public 
Task 
< 
bool 
> 
RoleExistsAsync )
() *
string* 0
roleName1 9
)9 :
{ 	
return 
_roleManager 
.  
RoleExistsAsync  /
(/ 0
roleName0 8
)8 9
;9 :
} 	
} 
} ∞	
?E:\CleanArchitecture\Infrastructure\Wrappers\CustomerWrapper.cs
	namespace 	
Infrastructure
 
. 
Wrappers !
{ 
public 

class 
CustomerWrapper  
:! "
ICustomerWrapper# 3
{ 
private 
readonly 
CqrsDbContext &
_context' /
;/ 0
public 
CustomerWrapper 
( 
CqrsDbContext ,
context- 4
)4 5
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
int 
> 
AddCustomer *
(* +
Customer+ 3
customer4 <
)< =
{ 	
_context 
. 
	Customers 
. 
Add "
(" #
customer# +
)+ ,
;, -
return 
await 
_context !
.! "
SaveChangesAsync" 2
(2 3
)3 4
;4 5
} 	
} 
} ¨9
CE:\CleanArchitecture\Infrastructure\Services\RefreshTokenService.cs
	namespace 	
Infrastructure
 
. 
Services !
{ 
public 

class 
RefreshTokenService $
:% & 
IRefreshTokenService' ;
{ 
private 
readonly  
ConcurrentDictionary -
<- .
string. 4
,4 5
(6 7
string7 =
UserName> F
,F G
DateTimeH P

ExpiryDateQ [
)[ \
>\ ]
_refreshTokens^ l
=m n
newo r
(r s
)s t
;t u
public 
void 
AddRefreshToken #
(# $
string$ *
refreshToken+ 7
,7 8
string9 ?
userName@ H
,H I
DateTimeJ R

expiryDateS ]
)] ^
{ 	
_refreshTokens 
. 
TryAdd !
(! "
refreshToken" .
,. /
(0 1
userName1 9
,9 :

expiryDate; E
)E F
)F G
;G H
} 	
public 
( 
string 
UserName 
,  
DateTime! )

ExpiryDate* 4
)4 5
?5 6
GetRefreshToken7 F
(F G
stringG M
refreshTokenN Z
)Z [
{ 	
if 
( 
_refreshTokens 
. 
TryGetValue *
(* +
refreshToken+ 7
,7 8
out9 <
var= @
refreshTokenValueA R
)R S
)S T
{ 
return 
refreshTokenValue (
;( )
} 
return 
null 
; 
}   	
public"" 
string"" 
GetUserName"" !
(""! "
)""" #
{## 	
return$$ 
_refreshTokens$$ !
.$$! "
First$$" '
($$' (
)$$( )
.$$) *
Value$$* /
.$$/ 0
UserName$$0 8
;$$8 9
}%% 	
public'' 
async'' 
Task'' 
<'' 
string''  
>''  !!
GetJWTAndRefreshToken''" 7
(''7 8
IUserManagerWrapper''8 K
userManager''L W
,''W X
IConfiguration''Y g
configuration''h u
,''u v
string''w }
userName	''~ Ü
,
''Ü á
User
''à å
user
''ç ë
)
''ë í
{(( 	
var)) 
jwtKey)) 
=)) 
configuration)) &
[))& '
$str))' 0
]))0 1
;))1 2
if** 
(** 
jwtKey** 
!=** 
null** 
)** 
{++ 
var,, 
	secretKey,, 
=,, 
new,,  # 
SymmetricSecurityKey,,$ 8
(,,8 9
Encoding,,9 A
.,,A B
UTF8,,B F
.,,F G
GetBytes,,G O
(,,O P
jwtKey,,P V
),,V W
),,W X
;,,X Y
var.. 
signinCredentials.. %
=..& '
new..( +
SigningCredentials.., >
(..> ?
	secretKey..? H
,..H I
SecurityAlgorithms..J \
...\ ]

HmacSha256..] g
)..g h
;..h i
var00 
roles00 
=00 
await00 !
userManager00" -
.00- .
GetRolesAsync00. ;
(00; <
user00< @
)00@ A
;00A B
var11 
claims11 
=11 
new11  
List11! %
<11% &
Claim11& +
>11+ ,
(11, -
)11- .
;11. /
foreach22 
(22 
var22 
role22 !
in22" $
roles22% *
)22* +
{33 
claims44 
.44 
Add44 
(44 
new44 "
Claim44# (
(44( )

ClaimTypes44) 3
.443 4
Name444 8
,448 9
userName44: B
)44B C
)44C D
;44D E
claims55 
.55 
Add55 
(55 
new55 "
Claim55# (
(55( )

ClaimTypes55) 3
.553 4
Role554 8
,558 9
role55: >
)55> ?
)55? @
;55@ A
}66 
var77 
tokenOptions77  
=77! "
new77# &
JwtSecurityToken77' 7
(777 8
issuer88 
:88 
configuration88 )
[88) *
$str88* 6
]886 7
,887 8
audience99 
:99 
configuration99 +
[99+ ,
$str99, 8
]998 9
,999 :
claims:: 
::: 
claims:: "
,::" #
expires;; 
:;; 
DateTime;; %
.;;% &
Now;;& )
.;;) *

AddSeconds;;* 4
(;;4 5
$num;;5 7
);;7 8
,;;8 9
signingCredentials<< &
:<<& '
signinCredentials<<( 9
)== 
;== 
var?? 
jwtToken?? 
=?? 
new?? "#
JwtSecurityTokenHandler??# :
(??: ;
)??; <
.??< =

WriteToken??= G
(??G H
tokenOptions??H T
)??T U
;??U V
varAA 
refreshTokenAA  
=AA! " 
GenerateRefreshTokenAA# 7
(AA7 8
)AA8 9
;AA9 :
varBB 
	tokenDataBB 
=BB 
newBB  #
{CC 
AccessTokenDD 
=DD  !
jwtTokenDD" *
,DD* +
RefreshTokenEE  
=EE! "
refreshTokenEE# /
.EE/ 0
TokenEE0 5
}FF 
;FF 
AddRefreshTokenHH 
(HH  
refreshTokenHH  ,
.HH, -
TokenHH- 2
,HH2 3
userNameHH4 <
,HH< =
refreshTokenHH> J
.HHJ K
ExpiresHHK R
)HHR S
;HHS T
returnII 
JsonConvertII "
.II" #
SerializeObjectII# 2
(II2 3
	tokenDataII3 <
)II< =
;II= >
}JJ 
elseKK 
{LL 
throwMM 
newMM %
InvalidOperationExceptionMM 3
(MM3 4
$strMM4 E
)MME F
;MMF G
}NN 
}OO 	
privateQQ 
staticQQ 
RefreshTokenQQ # 
GenerateRefreshTokenQQ$ 8
(QQ8 9
)QQ9 :
{RR 	
returnSS 
newSS 
RefreshTokenSS #
(SS# $
)SS$ %
{TT 
TokenUU 
=UU 
ConvertUU 
.UU  
ToBase64StringUU  .
(UU. /!
RandomNumberGeneratorUU/ D
.UUD E
GetBytesUUE M
(UUM N
$numUUN P
)UUP Q
)UUQ R
,UUR S
ExpiresVV 
=VV 
DateTimeVV "
.VV" #
NowVV# &
.VV& '

AddMinutesVV' 1
(VV1 2
$numVV2 3
)VV3 4
}WW 
;WW 
}XX 	
}YY 
}ZZ “
<E:\CleanArchitecture\Infrastructure\Services\EmailService.cs
	namespace 	
Infrastructure
 
. 
Services !
{ 
public 

class 
EmailService 
: 
IEmailService  -
{ 
private		 
readonly		 
static		 
string		  &
personalEmail		' 4
=		5 6
$str		7 R
;		R S
private

 
readonly

 
static

 
string

  &
personalPassword

' 7
=

8 9
Environment

: E
.

E F"
GetEnvironmentVariable

F \
(

\ ]
$str

] q
)

q r
!

r s
;

s t
public 
async 
Task 
SendEmailAsync (
(( )
string) /
email0 5
,5 6
string7 =
subject> E
,E F
stringG M
messageN U
)U V
{ 	
try 
{ 
var 

smtpClient 
=  
new! $

SmtpClient% /
(/ 0
$str0 @
)@ A
{ 
Port 
= 
$num 
, 
Credentials 
=  !
new" %
NetworkCredential& 7
(7 8
personalEmail8 E
,E F
personalPasswordG W
)W X
,X Y
	EnableSsl 
= 
true  $
,$ %
} 
; 
await 

smtpClient  
.  !
SendMailAsync! .
(. /
personalEmail/ <
,< =
email> C
,C D
subjectE L
,L M
messageN U
)U V
;V W
} 
catch 
( 
	Exception 
ex 
) 
{ 
throw 
new %
InvalidOperationException 3
(3 4
$"4 6
$str6 J
{J K
exK M
.M N
MessageN U
}U V
"V W
)W X
;X Y
} 
} 	
}   
}!! ⁄
OE:\CleanArchitecture\Infrastructure\Persistence\Repositories\ApplicationUser.cs
	namespace 	
Infrastructure
 
. 
Persistence $
.$ %
Repositories% 1
{ 
public 

class 
ApplicationUser  
:! "
IdentityUser# /
</ 0
string0 6
>6 7
{ 
public 
DateTime 
? 
RecentLogin $
{% &
get' *
;* +
set, /
;/ 0
}1 2
}		 
}

 ˘!
ZE:\CleanArchitecture\Infrastructure\Persistence\Migrations\20240403100229_CustomerAdded.cs
	namespace 	
Infrastructure
 
. 
Persistence $
.$ %

Migrations% /
{ 
public		 

partial		 
class		 
CustomerAdded		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str !
,! "
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ D
,D E)
NpgsqlValueGenerationStrategyF c
.c d#
IdentityByDefaultColumnd {
){ |
,| }
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
trueH L
)L M
,M N
Address 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 ?
,? @
nullableA I
:I J
trueK O
)O P
,P Q
PhoneNumber 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
trueO S
)S T
,T U
Active 
= 
table "
." #
Column# )
<) *
bool* .
>. /
(/ 0
type0 4
:4 5
$str6 ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
UserId 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
trueJ N
)N O
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 3
,3 4
x5 6
=>7 9
x: ;
.; <
Id< >
)> ?
;? @
table 
. 

ForeignKey $
($ %
name 
: 
$str ?
,? @
column 
: 
x  !
=>" $
x% &
.& '
UserId' -
,- .
principalTable   &
:  & '
$str  ( 5
,  5 6
principalColumn!! '
:!!' (
$str!!) -
)!!- .
;!!. /
}"" 
)"" 
;"" 
migrationBuilder$$ 
.$$ 
CreateIndex$$ (
($$( )
name%% 
:%% 
$str%% +
,%%+ ,
table&& 
:&& 
$str&& "
,&&" #
column'' 
:'' 
$str''  
)''  !
;''! "
}(( 	
	protected++ 
override++ 
void++ 
Down++  $
(++$ %
MigrationBuilder++% 5
migrationBuilder++6 F
)++F G
{,, 	
migrationBuilder-- 
.-- 
	DropTable-- &
(--& '
name.. 
:.. 
$str.. !
)..! "
;.." #
}// 	
}00 
}11 ﬁ»
ZE:\CleanArchitecture\Infrastructure\Persistence\Migrations\20240401112431_InitialCreate.cs
	namespace 	
Infrastructure
 
. 
Persistence $
.$ %

Migrations% /
{		 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
type. 2
:2 3
$str4 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 N
,N O
	maxLengthP Y
:Y Z
$num[ ^
,^ _
nullable` h
:h i
truej n
)n o
,o p
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
type: >
:> ?
$str@ X
,X Y
	maxLengthZ c
:c d
$nume h
,h i
nullablej r
:r s
truet x
)x y
,y z
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
type< @
:@ A
$strB H
,H I
nullableJ R
:R S
trueT X
)X Y
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns   
:   
table   
=>   !
new  " %
{!! 
Id"" 
="" 
table"" 
."" 
Column"" %
<""% &
string""& ,
>"", -
(""- .
type"". 2
:""2 3
$str""4 :
,"": ;
nullable""< D
:""D E
false""F K
)""K L
,""L M
RecentLogin## 
=##  !
table##" '
.##' (
Column##( .
<##. /
DateTime##/ 7
>##7 8
(##8 9
type##9 =
:##= >
$str##? Y
,##Y Z
nullable##[ c
:##c d
true##e i
)##i j
,##j k
UserName$$ 
=$$ 
table$$ $
.$$$ %
Column$$% +
<$$+ ,
string$$, 2
>$$2 3
($$3 4
type$$4 8
:$$8 9
$str$$: R
,$$R S
	maxLength$$T ]
:$$] ^
$num$$_ b
,$$b c
nullable$$d l
:$$l m
true$$n r
)$$r s
,$$s t
NormalizedUserName%% &
=%%' (
table%%) .
.%%. /
Column%%/ 5
<%%5 6
string%%6 <
>%%< =
(%%= >
type%%> B
:%%B C
$str%%D \
,%%\ ]
	maxLength%%^ g
:%%g h
$num%%i l
,%%l m
nullable%%n v
:%%v w
true%%x |
)%%| }
,%%} ~
Email&& 
=&& 
table&& !
.&&! "
Column&&" (
<&&( )
string&&) /
>&&/ 0
(&&0 1
type&&1 5
:&&5 6
$str&&7 O
,&&O P
	maxLength&&Q Z
:&&Z [
$num&&\ _
,&&_ `
nullable&&a i
:&&i j
true&&k o
)&&o p
,&&p q
NormalizedEmail'' #
=''$ %
table''& +
.''+ ,
Column'', 2
<''2 3
string''3 9
>''9 :
('': ;
type''; ?
:''? @
$str''A Y
,''Y Z
	maxLength''[ d
:''d e
$num''f i
,''i j
nullable''k s
:''s t
true''u y
)''y z
,''z {
EmailConfirmed(( "
=((# $
table((% *
.((* +
Column((+ 1
<((1 2
bool((2 6
>((6 7
(((7 8
type((8 <
:((< =
$str((> G
,((G H
nullable((I Q
:((Q R
false((S X
)((X Y
,((Y Z
PasswordHash))  
=))! "
table))# (
.))( )
Column))) /
<))/ 0
string))0 6
>))6 7
())7 8
type))8 <
:))< =
$str))> D
,))D E
nullable))F N
:))N O
true))P T
)))T U
,))U V
SecurityStamp** !
=**" #
table**$ )
.**) *
Column*** 0
<**0 1
string**1 7
>**7 8
(**8 9
type**9 =
:**= >
$str**? E
,**E F
nullable**G O
:**O P
true**Q U
)**U V
,**V W
ConcurrencyStamp++ $
=++% &
table++' ,
.++, -
Column++- 3
<++3 4
string++4 :
>++: ;
(++; <
type++< @
:++@ A
$str++B H
,++H I
nullable++J R
:++R S
true++T X
)++X Y
,++Y Z
PhoneNumber,, 
=,,  !
table,," '
.,,' (
Column,,( .
<,,. /
string,,/ 5
>,,5 6
(,,6 7
type,,7 ;
:,,; <
$str,,= C
,,,C D
nullable,,E M
:,,M N
true,,O S
),,S T
,,,T U 
PhoneNumberConfirmed-- (
=--) *
table--+ 0
.--0 1
Column--1 7
<--7 8
bool--8 <
>--< =
(--= >
type--> B
:--B C
$str--D M
,--M N
nullable--O W
:--W X
false--Y ^
)--^ _
,--_ `
TwoFactorEnabled.. $
=..% &
table..' ,
..., -
Column..- 3
<..3 4
bool..4 8
>..8 9
(..9 :
type..: >
:..> ?
$str..@ I
,..I J
nullable..K S
:..S T
false..U Z
)..Z [
,..[ \

LockoutEnd// 
=//  
table//! &
.//& '
Column//' -
<//- .
DateTimeOffset//. <
>//< =
(//= >
type//> B
://B C
$str//D ^
,//^ _
nullable//` h
://h i
true//j n
)//n o
,//o p
LockoutEnabled00 "
=00# $
table00% *
.00* +
Column00+ 1
<001 2
bool002 6
>006 7
(007 8
type008 <
:00< =
$str00> G
,00G H
nullable00I Q
:00Q R
false00S X
)00X Y
,00Y Z
AccessFailedCount11 %
=11& '
table11( -
.11- .
Column11. 4
<114 5
int115 8
>118 9
(119 :
type11: >
:11> ?
$str11@ I
,11I J
nullable11K S
:11S T
false11U Z
)11Z [
}22 
,22 
constraints33 
:33 
table33 "
=>33# %
{44 
table55 
.55 

PrimaryKey55 $
(55$ %
$str55% 5
,555 6
x557 8
=>559 ;
x55< =
.55= >
Id55> @
)55@ A
;55A B
}66 
)66 
;66 
migrationBuilder88 
.88 
CreateTable88 (
(88( )
name99 
:99 
$str99 (
,99( )
columns:: 
::: 
table:: 
=>:: !
new::" %
{;; 
Id<< 
=<< 
table<< 
.<< 
Column<< %
<<<% &
int<<& )
><<) *
(<<* +
type<<+ /
:<</ 0
$str<<1 :
,<<: ;
nullable<<< D
:<<D E
false<<F K
)<<K L
.== 

Annotation== #
(==# $
$str==$ D
,==D E)
NpgsqlValueGenerationStrategy==F c
.==c d#
IdentityByDefaultColumn==d {
)=={ |
,==| }
RoleId>> 
=>> 
table>> "
.>>" #
Column>># )
<>>) *
string>>* 0
>>>0 1
(>>1 2
type>>2 6
:>>6 7
$str>>8 >
,>>> ?
nullable>>@ H
:>>H I
false>>J O
)>>O P
,>>P Q
	ClaimType?? 
=?? 
table??  %
.??% &
Column??& ,
<??, -
string??- 3
>??3 4
(??4 5
type??5 9
:??9 :
$str??; A
,??A B
nullable??C K
:??K L
true??M Q
)??Q R
,??R S

ClaimValue@@ 
=@@  
table@@! &
.@@& '
Column@@' -
<@@- .
string@@. 4
>@@4 5
(@@5 6
type@@6 :
:@@: ;
$str@@< B
,@@B C
nullable@@D L
:@@L M
true@@N R
)@@R S
}AA 
,AA 
constraintsBB 
:BB 
tableBB "
=>BB# %
{CC 
tableDD 
.DD 

PrimaryKeyDD $
(DD$ %
$strDD% :
,DD: ;
xDD< =
=>DD> @
xDDA B
.DDB C
IdDDC E
)DDE F
;DDF G
tableEE 
.EE 

ForeignKeyEE $
(EE$ %
nameFF 
:FF 
$strFF F
,FFF G
columnGG 
:GG 
xGG  !
=>GG" $
xGG% &
.GG& '
RoleIdGG' -
,GG- .
principalTableHH &
:HH& '
$strHH( 5
,HH5 6
principalColumnII '
:II' (
$strII) -
,II- .
onDeleteJJ  
:JJ  !
ReferentialActionJJ" 3
.JJ3 4
CascadeJJ4 ;
)JJ; <
;JJ< =
}KK 
)KK 
;KK 
migrationBuilderMM 
.MM 
CreateTableMM (
(MM( )
nameNN 
:NN 
$strNN (
,NN( )
columnsOO 
:OO 
tableOO 
=>OO !
newOO" %
{PP 
IdQQ 
=QQ 
tableQQ 
.QQ 
ColumnQQ %
<QQ% &
intQQ& )
>QQ) *
(QQ* +
typeQQ+ /
:QQ/ 0
$strQQ1 :
,QQ: ;
nullableQQ< D
:QQD E
falseQQF K
)QQK L
.RR 

AnnotationRR #
(RR# $
$strRR$ D
,RRD E)
NpgsqlValueGenerationStrategyRRF c
.RRc d#
IdentityByDefaultColumnRRd {
)RR{ |
,RR| }
UserIdSS 
=SS 
tableSS "
.SS" #
ColumnSS# )
<SS) *
stringSS* 0
>SS0 1
(SS1 2
typeSS2 6
:SS6 7
$strSS8 >
,SS> ?
nullableSS@ H
:SSH I
falseSSJ O
)SSO P
,SSP Q
	ClaimTypeTT 
=TT 
tableTT  %
.TT% &
ColumnTT& ,
<TT, -
stringTT- 3
>TT3 4
(TT4 5
typeTT5 9
:TT9 :
$strTT; A
,TTA B
nullableTTC K
:TTK L
trueTTM Q
)TTQ R
,TTR S

ClaimValueUU 
=UU  
tableUU! &
.UU& '
ColumnUU' -
<UU- .
stringUU. 4
>UU4 5
(UU5 6
typeUU6 :
:UU: ;
$strUU< B
,UUB C
nullableUUD L
:UUL M
trueUUN R
)UUR S
}VV 
,VV 
constraintsWW 
:WW 
tableWW "
=>WW# %
{XX 
tableYY 
.YY 

PrimaryKeyYY $
(YY$ %
$strYY% :
,YY: ;
xYY< =
=>YY> @
xYYA B
.YYB C
IdYYC E
)YYE F
;YYF G
tableZZ 
.ZZ 

ForeignKeyZZ $
(ZZ$ %
name[[ 
:[[ 
$str[[ F
,[[F G
column\\ 
:\\ 
x\\  !
=>\\" $
x\\% &
.\\& '
UserId\\' -
,\\- .
principalTable]] &
:]]& '
$str]]( 5
,]]5 6
principalColumn^^ '
:^^' (
$str^^) -
,^^- .
onDelete__  
:__  !
ReferentialAction__" 3
.__3 4
Cascade__4 ;
)__; <
;__< =
}`` 
)`` 
;`` 
migrationBuilderbb 
.bb 
CreateTablebb (
(bb( )
namecc 
:cc 
$strcc (
,cc( )
columnsdd 
:dd 
tabledd 
=>dd !
newdd" %
{ee 
LoginProviderff !
=ff" #
tableff$ )
.ff) *
Columnff* 0
<ff0 1
stringff1 7
>ff7 8
(ff8 9
typeff9 =
:ff= >
$strff? E
,ffE F
nullableffG O
:ffO P
falseffQ V
)ffV W
,ffW X
ProviderKeygg 
=gg  !
tablegg" '
.gg' (
Columngg( .
<gg. /
stringgg/ 5
>gg5 6
(gg6 7
typegg7 ;
:gg; <
$strgg= C
,ggC D
nullableggE M
:ggM N
falseggO T
)ggT U
,ggU V
ProviderDisplayNamehh '
=hh( )
tablehh* /
.hh/ 0
Columnhh0 6
<hh6 7
stringhh7 =
>hh= >
(hh> ?
typehh? C
:hhC D
$strhhE K
,hhK L
nullablehhM U
:hhU V
truehhW [
)hh[ \
,hh\ ]
UserIdii 
=ii 
tableii "
.ii" #
Columnii# )
<ii) *
stringii* 0
>ii0 1
(ii1 2
typeii2 6
:ii6 7
$strii8 >
,ii> ?
nullableii@ H
:iiH I
falseiiJ O
)iiO P
}jj 
,jj 
constraintskk 
:kk 
tablekk "
=>kk# %
{ll 
tablemm 
.mm 

PrimaryKeymm $
(mm$ %
$strmm% :
,mm: ;
xmm< =
=>mm> @
newmmA D
{mmE F
xmmG H
.mmH I
LoginProvidermmI V
,mmV W
xmmX Y
.mmY Z
ProviderKeymmZ e
}mmf g
)mmg h
;mmh i
tablenn 
.nn 

ForeignKeynn $
(nn$ %
nameoo 
:oo 
$stroo F
,ooF G
columnpp 
:pp 
xpp  !
=>pp" $
xpp% &
.pp& '
UserIdpp' -
,pp- .
principalTableqq &
:qq& '
$strqq( 5
,qq5 6
principalColumnrr '
:rr' (
$strrr) -
,rr- .
onDeletess  
:ss  !
ReferentialActionss" 3
.ss3 4
Cascadess4 ;
)ss; <
;ss< =
}tt 
)tt 
;tt 
migrationBuildervv 
.vv 
CreateTablevv (
(vv( )
nameww 
:ww 
$strww '
,ww' (
columnsxx 
:xx 
tablexx 
=>xx !
newxx" %
{yy 
UserIdzz 
=zz 
tablezz "
.zz" #
Columnzz# )
<zz) *
stringzz* 0
>zz0 1
(zz1 2
typezz2 6
:zz6 7
$strzz8 >
,zz> ?
nullablezz@ H
:zzH I
falsezzJ O
)zzO P
,zzP Q
RoleId{{ 
={{ 
table{{ "
.{{" #
Column{{# )
<{{) *
string{{* 0
>{{0 1
({{1 2
type{{2 6
:{{6 7
$str{{8 >
,{{> ?
nullable{{@ H
:{{H I
false{{J O
){{O P
}|| 
,|| 
constraints}} 
:}} 
table}} "
=>}}# %
{~~ 
table 
. 

PrimaryKey $
($ %
$str% 9
,9 :
x; <
=>= ?
new@ C
{D E
xF G
.G H
UserIdH N
,N O
xP Q
.Q R
RoleIdR X
}Y Z
)Z [
;[ \
table
ÄÄ 
.
ÄÄ 

ForeignKey
ÄÄ $
(
ÄÄ$ %
name
ÅÅ 
:
ÅÅ 
$str
ÅÅ E
,
ÅÅE F
column
ÇÇ 
:
ÇÇ 
x
ÇÇ  !
=>
ÇÇ" $
x
ÇÇ% &
.
ÇÇ& '
RoleId
ÇÇ' -
,
ÇÇ- .
principalTable
ÉÉ &
:
ÉÉ& '
$str
ÉÉ( 5
,
ÉÉ5 6
principalColumn
ÑÑ '
:
ÑÑ' (
$str
ÑÑ) -
,
ÑÑ- .
onDelete
ÖÖ  
:
ÖÖ  !
ReferentialAction
ÖÖ" 3
.
ÖÖ3 4
Cascade
ÖÖ4 ;
)
ÖÖ; <
;
ÖÖ< =
table
ÜÜ 
.
ÜÜ 

ForeignKey
ÜÜ $
(
ÜÜ$ %
name
áá 
:
áá 
$str
áá E
,
ááE F
column
àà 
:
àà 
x
àà  !
=>
àà" $
x
àà% &
.
àà& '
UserId
àà' -
,
àà- .
principalTable
ââ &
:
ââ& '
$str
ââ( 5
,
ââ5 6
principalColumn
ää '
:
ää' (
$str
ää) -
,
ää- .
onDelete
ãã  
:
ãã  !
ReferentialAction
ãã" 3
.
ãã3 4
Cascade
ãã4 ;
)
ãã; <
;
ãã< =
}
åå 
)
åå 
;
åå 
migrationBuilder
éé 
.
éé 
CreateTable
éé (
(
éé( )
name
èè 
:
èè 
$str
èè (
,
èè( )
columns
êê 
:
êê 
table
êê 
=>
êê !
new
êê" %
{
ëë 
UserId
íí 
=
íí 
table
íí "
.
íí" #
Column
íí# )
<
íí) *
string
íí* 0
>
íí0 1
(
íí1 2
type
íí2 6
:
íí6 7
$str
íí8 >
,
íí> ?
nullable
íí@ H
:
ííH I
false
ííJ O
)
ííO P
,
ííP Q
LoginProvider
ìì !
=
ìì" #
table
ìì$ )
.
ìì) *
Column
ìì* 0
<
ìì0 1
string
ìì1 7
>
ìì7 8
(
ìì8 9
type
ìì9 =
:
ìì= >
$str
ìì? E
,
ììE F
nullable
ììG O
:
ììO P
false
ììQ V
)
ììV W
,
ììW X
Name
îî 
=
îî 
table
îî  
.
îî  !
Column
îî! '
<
îî' (
string
îî( .
>
îî. /
(
îî/ 0
type
îî0 4
:
îî4 5
$str
îî6 <
,
îî< =
nullable
îî> F
:
îîF G
false
îîH M
)
îîM N
,
îîN O
Value
ïï 
=
ïï 
table
ïï !
.
ïï! "
Column
ïï" (
<
ïï( )
string
ïï) /
>
ïï/ 0
(
ïï0 1
type
ïï1 5
:
ïï5 6
$str
ïï7 =
,
ïï= >
nullable
ïï? G
:
ïïG H
true
ïïI M
)
ïïM N
}
ññ 
,
ññ 
constraints
óó 
:
óó 
table
óó "
=>
óó# %
{
òò 
table
ôô 
.
ôô 

PrimaryKey
ôô $
(
ôô$ %
$str
ôô% :
,
ôô: ;
x
ôô< =
=>
ôô> @
new
ôôA D
{
ôôE F
x
ôôG H
.
ôôH I
UserId
ôôI O
,
ôôO P
x
ôôQ R
.
ôôR S
LoginProvider
ôôS `
,
ôô` a
x
ôôb c
.
ôôc d
Name
ôôd h
}
ôôi j
)
ôôj k
;
ôôk l
table
öö 
.
öö 

ForeignKey
öö $
(
öö$ %
name
õõ 
:
õõ 
$str
õõ F
,
õõF G
column
úú 
:
úú 
x
úú  !
=>
úú" $
x
úú% &
.
úú& '
UserId
úú' -
,
úú- .
principalTable
ùù &
:
ùù& '
$str
ùù( 5
,
ùù5 6
principalColumn
ûû '
:
ûû' (
$str
ûû) -
,
ûû- .
onDelete
üü  
:
üü  !
ReferentialAction
üü" 3
.
üü3 4
Cascade
üü4 ;
)
üü; <
;
üü< =
}
†† 
)
†† 
;
†† 
migrationBuilder
¢¢ 
.
¢¢ 
CreateIndex
¢¢ (
(
¢¢( )
name
££ 
:
££ 
$str
££ 2
,
££2 3
table
§§ 
:
§§ 
$str
§§ )
,
§§) *
column
•• 
:
•• 
$str
••  
)
••  !
;
••! "
migrationBuilder
ßß 
.
ßß 
CreateIndex
ßß (
(
ßß( )
name
®® 
:
®® 
$str
®® %
,
®®% &
table
©© 
:
©© 
$str
©© $
,
©©$ %
column
™™ 
:
™™ 
$str
™™ (
,
™™( )
unique
´´ 
:
´´ 
true
´´ 
)
´´ 
;
´´ 
migrationBuilder
≠≠ 
.
≠≠ 
CreateIndex
≠≠ (
(
≠≠( )
name
ÆÆ 
:
ÆÆ 
$str
ÆÆ 2
,
ÆÆ2 3
table
ØØ 
:
ØØ 
$str
ØØ )
,
ØØ) *
column
∞∞ 
:
∞∞ 
$str
∞∞  
)
∞∞  !
;
∞∞! "
migrationBuilder
≤≤ 
.
≤≤ 
CreateIndex
≤≤ (
(
≤≤( )
name
≥≥ 
:
≥≥ 
$str
≥≥ 2
,
≥≥2 3
table
¥¥ 
:
¥¥ 
$str
¥¥ )
,
¥¥) *
column
µµ 
:
µµ 
$str
µµ  
)
µµ  !
;
µµ! "
migrationBuilder
∑∑ 
.
∑∑ 
CreateIndex
∑∑ (
(
∑∑( )
name
∏∏ 
:
∏∏ 
$str
∏∏ 1
,
∏∏1 2
table
ππ 
:
ππ 
$str
ππ (
,
ππ( )
column
∫∫ 
:
∫∫ 
$str
∫∫  
)
∫∫  !
;
∫∫! "
migrationBuilder
ºº 
.
ºº 
CreateIndex
ºº (
(
ºº( )
name
ΩΩ 
:
ΩΩ 
$str
ΩΩ "
,
ΩΩ" #
table
ææ 
:
ææ 
$str
ææ $
,
ææ$ %
column
øø 
:
øø 
$str
øø )
)
øø) *
;
øø* +
migrationBuilder
¡¡ 
.
¡¡ 
CreateIndex
¡¡ (
(
¡¡( )
name
¬¬ 
:
¬¬ 
$str
¬¬ %
,
¬¬% &
table
√√ 
:
√√ 
$str
√√ $
,
√√$ %
column
ƒƒ 
:
ƒƒ 
$str
ƒƒ ,
,
ƒƒ, -
unique
≈≈ 
:
≈≈ 
true
≈≈ 
)
≈≈ 
;
≈≈ 
}
∆∆ 	
	protected
…… 
override
…… 
void
…… 
Down
……  $
(
……$ %
MigrationBuilder
……% 5
migrationBuilder
……6 F
)
……F G
{
   	
migrationBuilder
ÀÀ 
.
ÀÀ 
	DropTable
ÀÀ &
(
ÀÀ& '
name
ÃÃ 
:
ÃÃ 
$str
ÃÃ (
)
ÃÃ( )
;
ÃÃ) *
migrationBuilder
ŒŒ 
.
ŒŒ 
	DropTable
ŒŒ &
(
ŒŒ& '
name
œœ 
:
œœ 
$str
œœ (
)
œœ( )
;
œœ) *
migrationBuilder
—— 
.
—— 
	DropTable
—— &
(
——& '
name
““ 
:
““ 
$str
““ (
)
““( )
;
““) *
migrationBuilder
‘‘ 
.
‘‘ 
	DropTable
‘‘ &
(
‘‘& '
name
’’ 
:
’’ 
$str
’’ '
)
’’' (
;
’’( )
migrationBuilder
◊◊ 
.
◊◊ 
	DropTable
◊◊ &
(
◊◊& '
name
ÿÿ 
:
ÿÿ 
$str
ÿÿ (
)
ÿÿ( )
;
ÿÿ) *
migrationBuilder
⁄⁄ 
.
⁄⁄ 
	DropTable
⁄⁄ &
(
⁄⁄& '
name
€€ 
:
€€ 
$str
€€ #
)
€€# $
;
€€$ %
migrationBuilder
›› 
.
›› 
	DropTable
›› &
(
››& '
name
ﬁﬁ 
:
ﬁﬁ 
$str
ﬁﬁ #
)
ﬁﬁ# $
;
ﬁﬁ$ %
}
ﬂﬂ 	
}
‡‡ 
}·· ä
ME:\CleanArchitecture\Infrastructure\Persistence\DesignTimeDbContextFactory.cs
	namespace		 	
Infrastructure		
 
.		 
Persistence		 $
{

 
public 

class &
DesignTimeDbContextFactory +
:, -'
IDesignTimeDbContextFactory. I
<I J
CqrsDbContextJ W
>W X
{ 
public 
CqrsDbContext 
CreateDbContext ,
(, -
string- 3
[3 4
]4 5
args6 :
): ;
{ 	
var 
optionsBuilder 
=  
new! $#
DbContextOptionsBuilder% <
<< =
CqrsDbContext= J
>J K
(K L
)L M
;M N
var 

dbPassword 
= 
Environment (
.( )"
GetEnvironmentVariable) ?
(? @
$str@ O
)O P
;P Q
optionsBuilder 
. 
	UseNpgsql $
($ %
$"% '
$str' _
{_ `

dbPassword` j
}j k
"k l
)l m
;m n
return 
new 
CqrsDbContext $
($ %
optionsBuilder% 3
.3 4
Options4 ;
); <
;< =
} 	
} 
} é
@E:\CleanArchitecture\Infrastructure\Persistence\CqrsDbContext.cs
	namespace 	
Infrastructure
 
. 
Persistence $
{		 
[

 #
ExcludeFromCodeCoverage

 
]

 
public 

class 
CqrsDbContext 
( 
DbContextOptions /
</ 0
CqrsDbContext0 =
>= >
contextOptions? M
)M N
:O P
IdentityDbContextQ b
<b c
ApplicationUserc r
,r s
IdentityRole	t Ä
<
Ä Å
string
Å á
>
á à
,
à â
string
ä ê
>
ê ë
(
ë í
contextOptions
í †
)
† °
{ 
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
builder= D
)D E
{ 	
base 
. 
OnModelCreating  
(  !
builder! (
)( )
;) *
builder 
. 
Entity 
< 
Customer #
># $
($ %
)% &
. 
HasOne 
< 
ApplicationUser #
># $
($ %
)% &
. 
WithMany 
( 
) 
. 
HasForeignKey 
( 
c 
=> 
c  !
.! "
UserId" (
)( )
;) *
} 	
public 
DbSet 
< 
Customer 
> 
	Customers (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
override 
DbSet 
< 
ApplicationUser -
>- .
Users/ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
} 
} á
ME:\CleanArchitecture\Infrastructure\MappingProfiles\ApplicationUserProfile.cs
	namespace 	
Infrastructure
 
. 
MappingProfiles (
{ 
public 

class "
ApplicationUserProfile '
:( )
Profile* 1
{ 
public		 "
ApplicationUserProfile		 %
(		% &
)		& '
{

 	
	CreateMap 
< 
User 
, 
ApplicationUser +
>+ ,
(, -
)- .
;. /
	CreateMap 
< 
ApplicationUser %
,% &
User' +
>+ ,
(, -
)- .
;. /
} 	
} 
} √,
:E:\CleanArchitecture\Infrastructure\DependencyInjection.cs
	namespace 	
Infrastructure
 
{ 
public 

static 
class 
DependencyInjection +
{ 
public 
static 
IServiceCollection (
AddInfrastructure) :
(: ;
this; ?
IServiceCollection@ R
servicesS [
,[ \
IConfiguration] k
configurationl y
)y z
{ 	
services 
. 
AddDbContext !
<! "
CqrsDbContext" /
>/ 0
(0 1
options1 8
=>9 ;
{ 
System 
. 
Diagnostics #
.# $
Debug$ )
.) *
	WriteLine* 3
(3 4
$"4 6
$str6 E
{E F
EnvironmentF Q
.Q R"
GetEnvironmentVariableR h
(h i
$stri x
)x y
}y z
"z {
){ |
;| }
var #
connectionStringBuilder ,
=- .
new/ 2)
NpgsqlConnectionStringBuilder3 P
(P Q
configurationQ ^
.^ _
GetConnectionString_ r
(r s
$str	s Ü
)
Ü á
)
á à
{ 
Password 
= 
Environment  +
.+ ,"
GetEnvironmentVariable, B
(B C
$strC R
)R S
} 
; 
options 
. 
	UseNpgsql "
(" ##
connectionStringBuilder# :
.: ;
ConnectionString; K
,K L
bM N
=>O Q
bR S
.S T
MigrationsAssemblyT f
(f g
$strg w
)w x
)x y
;y z
options 
. &
EnableSensitiveDataLogging 3
(3 4
)4 5
;5 6
}   
)   
;   
services"" 
."" 
AddIdentity""  
<""  !
ApplicationUser""! 0
,""0 1
IdentityRole""2 >
<""> ?
string""? E
>""E F
>""F G
(""G H
)""H I
.## 
AddRoles## 
<## 
IdentityRole## &
<##& '
string##' -
>##- .
>##. /
(##/ 0
)##0 1
.$$ $
AddEntityFrameworkStores$$ )
<$$) *
CqrsDbContext$$* 7
>$$7 8
($$8 9
)$$9 :
.%% $
AddDefaultTokenProviders%% )
(%%) *
)%%* +
;%%+ ,
services'' 
.'' 
AddHangfire''  
(''  !
x''! "
=>''# %
x''& '
.''' ( 
UsePostgreSqlStorage''( <
(''< =
options''= D
=>''E G
{(( 
var)) #
connectionStringBuilder)) +
=)), -
new)). 1)
NpgsqlConnectionStringBuilder))2 O
())O P
configuration))P ]
.))] ^
GetConnectionString))^ q
())q r
$str	))r Ö
)
))Ö Ü
)
))Ü á
{** 
Password++ 
=++ 
Environment++ *
.++* +"
GetEnvironmentVariable+++ A
(++A B
$str++B Q
)++Q R
},, 
;,, 
options-- 
.-- 
UseNpgsqlConnection-- +
(--+ ,#
connectionStringBuilder--, C
.--C D
ConnectionString--D T
)--T U
;--U V
}.. 
).. 
).. 
;.. 
services// 
.// 
AddHangfireServer// &
(//& '
)//' (
;//( )
services11 
.11 
	AddScoped11 
<11 
IUserManagerWrapper11 2
,112 3
UserManagerWrapper114 F
>11F G
(11G H
)11H I
;11I J
services22 
.22 
	AddScoped22 
<22 
IRoleManagerWrapper22 2
,222 3
RoleManagerWrapper224 F
>22F G
(22G H
)22H I
;22I J
services33 
.33 
	AddScoped33 
<33 
ICustomerWrapper33 /
,33/ 0
CustomerWrapper331 @
>33@ A
(33A B
)33B C
;33C D
services44 
.44 
	AddScoped44 
<44 
IEmailService44 ,
,44, -
EmailService44. :
>44: ;
(44; <
)44< =
;44= >
var66 
mappingConfig66 
=66 
new66  #
MapperConfiguration66$ 7
(667 8
mc668 :
=>66; =
{77 
mc88 
.88 

AddProfile88 
(88 
new88 !"
ApplicationUserProfile88" 8
(888 9
)889 :
)88: ;
;88; <
}:: 
):: 
;:: 
IMapper<< 
mapper<< 
=<< 
mappingConfig<< *
.<<* +
CreateMapper<<+ 7
(<<7 8
)<<8 9
;<<9 :
services== 
.== 
AddSingleton== !
(==! "
mapper==" (
)==( )
;==) *
services>> 
.>> 
AddSingleton>> !
<>>! " 
IRefreshTokenService>>" 6
,>>6 7
RefreshTokenService>>8 K
>>>K L
(>>L M
)>>M N
;>>N O
return?? 
services?? 
;?? 
}@@ 	
}AA 
}BB 